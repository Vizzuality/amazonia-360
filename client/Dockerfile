FROM node:22.2.0-alpine as base
LABEL maintainer="hello@vizzuality.com"

FROM base as production
ARG NEXT_PUBLIC_URL
ARG NEXT_PUBLIC_API_URL

ARG NEXT_PUBLIC_ARCGIS_API_KEY
ARG NEXT_PUBLIC_API_KEY
ARG ARCGIS_CLIENT_ID
ARG ARCGIS_CLIENT_SECRET

ARG BASIC_AUTH_USER
ARG BASIC_AUTH_PASSWORD

ENV NEXT_PUBLIC_URL $NEXT_PUBLIC_URL
ENV NEXT_PUBLIC_API_URL $NEXT_PUBLIC_API_URL

ENV NEXT_PUBLIC_ARCGIS_API_KEY $NEXT_PUBLIC_ARCGIS_API_KEY
ENV NEXT_PUBLIC_API_KEY $NEXT_PUBLIC_API_KEY
ENV ARCGIS_CLIENT_ID $ARCGIS_CLIENT_ID
ENV ARCGIS_CLIENT_SECRET $ARCGIS_CLIENT_SECRET

ENV BASIC_AUTH_USER $BASIC_AUTH_USER
ENV BASIC_AUTH_PASSWORD "$BASIC_AUTH_PASSWORD"

WORKDIR /app

COPY . .

RUN pnpm install

RUN pnpm build

EXPOSE 3000

CMD ["pnpm", "start"]
